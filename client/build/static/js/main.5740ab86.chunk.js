(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{16:function(e,t,n){},18:function(e,t,n){},23:function(e,t){},24:function(e,t){},25:function(e,t){},27:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),a=n(7),c=n.n(a),r=(n(16),n(17),n(18),n(2)),s=n(8),l=n(9),u=new(function(){function e(){Object(s.a)(this,e),this.events={}}return Object(l.a)(e,[{key:"emit",value:function(e,t){var n=this.events[e];n&&n.forEach((function(e){e.call(null,t)}))}},{key:"subscribe",value:function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){n.events[e]=n.events[e].filter((function(e){return t!==e}))}}}]),e}()),d=n(0);var f=function(e){return Object(d.jsxs)("div",{className:"upload-btn-wrapper",children:[Object(d.jsx)("button",{className:"btn",children:"Incarca imagine"}),Object(d.jsx)("input",{type:"file",onChange:function(e){var t=e.target.files[0],n=new FileReader;n.onload=function(e){u.emit("image_changed",e.target.result)},n.readAsDataURL(t)}})]})};var h,g,p,b=function(e){return Object(d.jsx)("div",{className:"download-btn-wrapper",children:Object(d.jsx)("button",{className:"btn",onClick:function(e){u.emit("download_image",{})},children:"Descarca imagine"})})},v={},m=void 0,j=void 0,w=[],O=!1,x=new r.fabric.Image.filters.Blur({blur:.3});function y(e){if(void 0!==e){var t=v.getWidth(),n=v.getHeight(),i=e.width,o=e.height;!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!==t?(t.e.preventDefault(),t.e.stopPropagation(),v.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},e)):v.setZoom(e);v.renderAll()}(Math.min(n/o,t/i),null,null)}}var _=function(e,t){e.cropX=t.transform.target.left,e.cropY=t.transform.target.top,e.width*=e.scaleX,e.height*=e.scaleY,e.scaleX=1,e.scaleY=1};var I=function(){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;void 0!==m&&(v.remove(m),v.remove(j)),m=e,v.add(m),y(e),m.set({selectable:!1,hoverCursor:"arrow"}),(j=r.fabric.util.object.clone(e)).set({opacity:1,selectable:!1}),j.filters.push(x),j.applyFilters(),v.add(j),j.bringToFront(),j.set({visible:!1,selectable:!1})};var E=function(e){var t=function(){v.setDimensions({width:window.innerWidth,height:window.innerHeight}),console.log(v.getZoom()),y(m),v.renderAll()};return Object(i.useEffect)((function(){return v=new r.fabric.Canvas("canvas_editor"),r.fabric.textureSize=6552236,t(),u.subscribe("download_image",(function(e){!function(){var e=v.toDataURL({format:"png",quality:1,top:0,left:0,width:m.width*m.scaleX*v.getZoom(),height:m.height*m.scaleY*v.getZoom()}),t=document.createElement("a");t.href="data:image/png;"+e,t.download="Blurez_image_output.png",t.click()}()})),u.subscribe("image_changed",(function(e){r.fabric.Image.fromURL(e,(function(e){var t=e.set({left:0,top:0,opacity:1,selectable:!0});I(0,0,t)}))})),window.addEventListener("resize",t,!1),v.on("mouse:down",(function(e){var t=0==v.getActiveObjects().length,n=v.getPointer(e.e),i=function(e,t,n){return n.x<=e&&n.y<=t}(m.width,m.height,n);if(O=t&&i){g=n.x,p=n.y;n=v.getPointer(e.e);h=new r.fabric.Rect({left:g,top:p,originX:"left",originY:"top",width:n.x-g,height:n.y-p,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1}),v.add(h)}})),v.on("mouse:move",(function(e){if(O){var t=v.getPointer(e.e),n=m.width,i=m.height,o=Math.min(t.x,n),a=Math.min(t.y,i);g>t.x&&h.set({left:Math.max(0,o)}),p>t.y&&h.set({top:Math.max(0,a)}),h.set({width:Math.abs(g-o)}),h.set({height:Math.abs(p-a)}),v.renderAll()}})),v.on("mouse:up",(function(e){void 0!==h&&1==O&&(!function(e,t,n,i){console.log(e,t,n,i);var o=r.fabric.util.object.clone(j);o.cropX=e,o.cropY=t,o.width=n,o.height=i,o.objectCaching=!1,v.add(o),o.bringToFront(),o.set({top:t,left:e,visible:!0,selectable:!0}),o.on("moving",(function(e){_(o,e)})),o.on("scaling",(function(e){_(o,e)})),w.push(o)}(h.left,h.top,h.width,h.height),v.remove(h),O=!1,h=void 0)})),r.fabric.Image.fromURL("./background_image.png",(function(e){var t=e.set({left:0,top:0,opacity:1,selectable:!1});I(0,0,t)}),{crossOrigin:"anonymous"}),function(){console.log("In useEffect cleanup")}}),[]),Object(d.jsxs)("div",{className:"canvas_wrapper",children:[Object(d.jsxs)("div",{className:"toolbar",children:[Object(d.jsx)(f,{}),Object(d.jsx)(b,{})]}),Object(d.jsx)("div",{className:"canvas_editor_wrapper",children:Object(d.jsx)("canvas",{id:"canvas_editor"})})]})},L=n(10),M=n(11),A=function(e,t){switch(t.type){case"CHANGE_IMAGE":return console.log(t),{selectedImage:t.payload};case"ADD_ITEM":return{shoppingList:[t.payload].concat(Object(M.a)(e.shoppingList))};case"REMOVE_ITEM":return{shoppingList:e.shoppingList.filter((function(e){return e!==t.payload}))};default:return e}},C={shoppingList:[],selectedImage:void 0},D=Object(i.createContext)(C),N=function(e){var t=e.children,n=Object(i.useReducer)(A,C),o=Object(L.a)(n,2),a=o[0],c=o[1];return Object(d.jsx)(D.Provider,{value:{selectedImage:a.selectedImage,shoppingList:a.shoppingList,addItemToList:function(e){c({type:"ADD_ITEM",payload:e})},removeItemFromList:function(e){c({type:"REMOVE_ITEM",payload:e})},change_loaded_image:function(e){c({type:"CHANGE_IMAGE",payload:e})}},children:t})};var T=function(){return Object(d.jsx)("div",{className:"App",children:Object(d.jsx)(N,{children:Object(d.jsx)(E,{})})})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,28)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),i(e),o(e),a(e),c(e)}))};c.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(T,{})}),document.getElementById("root")),F()}},[[27,1,2]]]);
//# sourceMappingURL=main.5740ab86.chunk.js.map